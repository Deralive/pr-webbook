# 贝叶斯公式

````{prf:theorem} 贝叶斯公式
:label: thm02-e

设$B_{1},B_{2},\cdots,B_{n}$为样本空间$\Omega$的一个分割，即$B_{1},B_{2},\cdots,B_{n}$互不相容，且$\cup_{i=1}^{n} B_{i}=\Omega $.如果$P(A)>0,P(B_{i})>0,i=1,2,\cdots,n$，则

$$P(B_{i} |A)=\frac{P(B_{i} )P(A|B_{i} )}{\sum_{j=1}^{n} P(B_{j} )P(A|B_{j} )} ,i=1,2,\cdots ,n.$$

```{dropdown} Proof

由条件概率的定义可知

$$P(B_{i} |A)=\frac{P(AB_{i} )}{P(A)} =\frac{P(B_{i} )P(A|B_{i} )}{\sum_{j=1}^{n} P(B_{j} )P(A|B_{j} )}.$$


在上式中，分子上应用了乘法公式（{prf:ref}`thm02-b`），分母上应用了全概率公式（{prf:ref}`thm02-d`）。因此，定理得证。
```
````

````{prf:example} 肝癌首测
:label: ex02-f

某地区居民的肝癌发病率为$0.0004$，现用甲胎蛋白法进行普查。医学研究表明，化验结果是可能存在错误的。已知患有肝癌的人其化验结果$99\%$呈阳性，而没患肝癌的人其化验结果$99.9\%$呈阴性。现某人的检查结果呈阳性，问他真的患肝癌的概率是多少？

```{dropdown} Solution

记$B$为事件“被检查者患有肝癌”，$A$为事件“检查结果呈阳性”。根据题目可知，
\begin{eqnarray*}
    P(B) &=& 0.0004, \quad P(\overline{B}) = 1- 0.0004 = 0.9996\\
    P(A|B) &=& 0.99, \quad P(A|\overline{B}) = 1- 0.999 = 0.001
\end{eqnarray*}
我们关心的问题是求$P(B|A)$。由贝叶斯公式得
\begin{eqnarray*}
    P(B|A) &=& \frac{P(B)P(A|B)}{P(B)P(A|B)+P(\overline{B})P(A|\overline{B}}\\
    &=& \frac{0.0004 \times 0.99}{0.0004\times 0.99 + 0.9996 \times 0.001} = 0.2837.
\end{eqnarray*}
这表明了，在检查结果呈阳性的人中，真患肝癌的人约为$28.37\%$。
```

```{prf:remark}

首次检验结果呈阳性出现高误报率的原因是：肝癌的发病率很低。在10000个人中约有4人患肝癌，而约有9996人不患肝癌。对10000个人用甲胎蛋白法进行检查，按其错检的概率可知，99996个不患肝癌的人约有$9996\times 0.001 = 9.996$个呈阳性。另外4个真患肝癌者的检查报告中约为$4\times 0.99 = 3.96$个呈阳性。从13.956个呈阳性者中，真患肝癌的3.96人约占28.37\%。
```
````

````{prf:example} 肝癌复测
:label: ex02-g
:class: dropdown

对首次检查呈阳性的人群再进行复查。此时$P(B)=0.2837$，再次使用贝叶斯公式可得
\begin{eqnarray*}
    P(B|A) &=& \frac{P(B)P(A|B)}{P(B)P(A|B)+P(\overline{B})P(A|\overline{B}}\\
    &=& \frac{0.2847 \times 0.99}{0.2847\times 0.99 + 0.7153 \times 0.001} = 0.9975.
\end{eqnarray*}

````

```{prf:example} “狼来了”

设事件$A$为“小孩说谎”，事件$B$为“小孩可信”。

不妨设村民过去对这个小孩的印象为

$$
P(B)=0.8 \quad P(\overline{B} )=0.2.
$$

第一次说谎后，村民对他的信任程度有所改变。我们假设可信的孩子说谎的概率为$P(A|B)=0.1$，不可信的孩子说谎的概率为$P(A|\overline{B})=0.4$.

利用贝叶斯公式，计算小孩第一次说谎后，其可信的概率为

$$
P(B|A)=\frac{P(B)P(A|B)}{P(B)P(A|B)+P(\overline{B} )P(A|\overline{B})} =\frac{0.8\times 0.1}{0.8\times 0.1+0.2\times 0.5}=0.444 .
$$

在一次说谎后，村民对小孩的信任程度由0.8变为0.444.即

$$
P(B)=0.444 \quad P(\overline{B} )=0.556.
$$

第二次说谎后，村民对他的信任程度为

$$
P(B|A)=\frac{0.444\times 0.1}{0.444\times 0.1+0.556\times 0.5}=0.138.
$$

这表明：村民经过两次上当后，对这个小孩的信任程度已经从0.8下降到了0.138，如此低的信任度，村民听到第三次呼叫时怎么会在上山打狼呢？
```




